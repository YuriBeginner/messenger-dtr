{% extends "admin/base.html" %}
{% block content %}

<div class="card-soft p-3">
  <div class="d-flex justify-content-between align-items-center mb-2">
    <div class="fw-bold">Join Code Management</div>

    {% if days_remaining is not none %}
      {% if days_remaining > 0 %}
        <span class="badge bg-success">Active • {{ days_remaining }} days left</span>
      {% else %}
        <span class="badge bg-danger">Expired</span>
      {% endif %}
    {% endif %}
  </div>

  <div class="subtle mb-3">
    Students must send this in Messenger:
    <span class="fw-semibold">JOIN {{ join_code or "—" }}</span>
  </div>

  {% if join_code %}
    <div class="row g-3 mb-3">
      <div class="col-md-4">
        <div class="border rounded p-2 text-center">
          <div class="subtle small">Join Code</div>
          <div class="fw-semibold">JOIN {{ join_code }}</div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="border rounded p-2 text-center">
          <div class="subtle small">Students Registered</div>
          <div class="fw-semibold">{{ student_count }}</div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="border rounded p-2 text-center">
          <div class="subtle small">Expiration</div>
          <div class="fw-semibold">
            {% if days_remaining is not none %}
              {{ days_remaining }} days
            {% else %}
              —
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="subtle mb-3">No join code yet. Generate one below.</div>
  {% endif %}

  <form method="post">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <input type="hidden" name="action" value="regen_join_code">
    <button class="btn btn-dark btn-sm" type="submit">
      Regenerate Join Code
    </button>
  </form>
</div>

{% if error %}
  <div class="alert alert-danger">{{ error }}</div>
{% endif %}
{% if success %}
  <div class="alert alert-success">{{ success }}</div>
{% endif %}

<div class="card-soft p-3">
  <div class="mb-3">
    <div class="fw-semibold">Branding</div>
    <div class="subtle">Customize how this portal looks for your institution.</div>
  </div>

  <form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <div class="mb-3">
      <label class="form-label">Organization Name</label>
      <input class="form-control" value="{{ org.name }}" disabled>
    </div>

    <div class="mb-3">
      <label class="form-label">Logo URL</label>
      <input name="logo_url" class="form-control" value="{{ org.logo_url or '' }}" placeholder="https://.../logo.png">
      <div class="subtle mt-1">MVP: paste a hosted logo URL (PNG/JPG/SVG). Upload support comes next.</div>
    </div>

    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">Primary Color</label>
        <input name="primary_color" class="form-control" value="{{ org.primary_color or '' }}" placeholder="#111827">
      </div>
      <div class="col-md-6">
        <label class="form-label">Secondary Color</label>
        <input name="secondary_color" class="form-control" value="{{ org.secondary_color or '' }}" placeholder="#3b82f6">
      </div>
    </div>
    <input type="hidden" name="action" value="save_branding">
    <button class="btn btn-primary mt-3" type="submit">Save Branding</button>
  </form>
</div>

{% if org.logo_url %}
  <div class="card-soft p-3 mt-3">
    <div class="fw-semibold mb-2">Preview</div>
    <img src="{{ org.logo_url }}" style="max-height:80px; max-width:100%; object-fit:contain;">
  </div>
{% endif %}

{% endblock %}
